$(function(){new CustomMap});var CustomMap=function(){"use strict";function a(){var a=new google.maps.LatLng(g.lat,g.lng),b={zoom:g.zoom,center:a};f=new google.maps.Map(document.getElementById("map-canvas"),b),ko.applyBindings(new e)}function b(){f.setCenter(new google.maps.LatLng(g.lat,g.lng)),f.setZoom(g.zoom)}function c(a){f.setCenter(new google.maps.LatLng(a.lat,a.lng)),f.setZoom(14)}function d(a,b,c,d){var e=this;e.name=a,e.lat=b,e.lng=c,e.wiki=d,e.visible=ko.observable(!0),e.marker=new google.maps.Marker({position:new google.maps.LatLng(b,c),map:f,title:a}),google.maps.event.addListener(e.marker,"click",function(){var a=setTimeout(function(){var a="<div><h3>"+e.name+"</h3><p>Wikipedia timeout / No internet connection error</p>";h.setContent(a),h.open(f,e.marker)},2500);$.ajax({url:"http://en.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=&exchars=800&titles="+e.wiki,dataType:"jsonp",headers:{"Api-User-Agent":"CustomMapLoader/1.0"}}).done(function(a){var b="<div><h3>"+e.name+"</h3>",c=a.query.pages;for(var d in c)c.hasOwnProperty(d)&&void 0!==c[d].extract&&(b+="<p>"+c[d].extract+"</p>");b+='<p>Read more: <a href="https://en.wikipedia.org/w/index.php?title='+e.wiki+'" target="_blank">Wikipedia article</a></p></div>',h.setContent(b),h.open(f,e.marker)}).fail(function(a){console.log("Data loading failed.",a),h.setContent("Data loading failed."),h.open(f,e.marker)}).always(function(){clearTimeout(a)})})}function e(){var a=this;a.selectedPoi=ko.observable(),a.filterText=ko.observable(),a.availablePois=[{name:"Castle Devin",lat:48.173852,lng:16.978212,wiki:"Devín_Castle"},{name:"Statue Slavin",lat:48.153878,lng:17.099839,wiki:"Slavín"},{name:"Bratislava Castle",lat:48.142095,lng:17.100857,wiki:"Bratislava Castle"},{name:"Bratislava ZOO",lat:48.163446,lng:17.071133,wiki:"Bratislava_Zoo"}];var e=$.map(a.availablePois,function(a){return new d(a.name,a.lat,a.lng,a.wiki)});a.pois=ko.observableArray(e),a.totalPois=ko.computed(function(){for(var b=0,c=0;c<a.pois().length;c++)a.pois()[c].visible()&&b++;return b}),a.selectPoi=function(b){a.selectedPoi(b),c(b)},a.filterList=function(){b();for(var c=a.filterText().toUpperCase(),d=0;d<a.pois().length;d++){var e=a.pois()[d].name.toUpperCase();-1!==e.search(c)?(a.pois()[d].visible(!0),a.pois()[d].marker.setMap(f)):(a.pois()[d].visible(!1),a.pois()[d].marker.setMap(null))}},a.resetList=function(){b(),a.filterText("");for(var c=0;c<a.pois().length;c++)a.pois()[c].visible(!0),a.pois()[c].marker.setMap(f)}}var f,g={lat:48.1430258,lng:17.1244572,zoom:11},h=new google.maps.InfoWindow;google.maps.event.addDomListener(window,"load",a)};